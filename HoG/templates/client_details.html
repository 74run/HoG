<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Heaven of Grace</title>
<style>
        /* Basic CSS for layout and styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            position: relative; /* Ensure relative positioning for absolute elements */
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }

        .table-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: 500px; /* Adjust max-height as needed */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            white-space: nowrap; /* Prevent text wrapping */
        }

        th {
            background-color: #333;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #ddd;
        }

        .delete-button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-button {
            background-color: blue;
            color: white;
            border: none;
            padding: 8px 12px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            border-radius: 4px;
            cursor: pointer;
        }
        

        .delete-button:hover {
            background-color: #d32f2f;
        }

        .back-to-form-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            border-radius: 4px;
            cursor: pointer;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .back-to-form-button:hover {
            background-color: #45a049;
        }

        .company-logo {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .company-logo img {
            height: 60px; /* Adjust the height as needed */
            width: auto;
        }

        /* Modal styling */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
    max-width: 600px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    animation: fadeIn 0.5s;
}

/* Add animation for modal */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* The Close Button */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

/* Form styling */
form {
    display: flex;
    flex-direction: column;
}

label {
    margin-top: 10px;
}

input, select, button {
    padding: 10px;
    margin-top: 5px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

button {
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 20px;
}

button:hover {
    background-color: #45a049;
}

h2 {
    margin-bottom: 20px;
    color: #333;
    font-family: 'Arial', sans-serif;
}

    </style>

</head>
<body>
    <div class="navbar">
        <div class="navbar-logo">
            <img src="./static/HoG.PNG" alt="Logo">
        </div>

    </div>

    <div class="container">
        <h1>Client Details</h1>
        <div class="search-bar">
            <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Search for clients..">
        </div>
        <div class="table-container">
            <table class="client-table" id="clientTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Zip Code</th>
                        <th>Phone</th>
                        <th>Birthdate</th>
                        <th>Age</th>
                        <th>Sex</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in clients %}
                    <tr data-id="{{ client._id }}">
                        <td>{{ client.client_details.name }}</td>
                        <td>{{ client.client_details.address }}</td>
                        <td>{{ client.client_details.zip_code }}</td>
                        <td>{{ client.client_details.phone }}</td>
                        <td>{{ client.client_details.birthdate }}</td>
                        <td>{{ client.client_details.age }}</td>
                        <td>{{ client.client_details.sex }}</td>
                        <td>
                            <button class="edit-button" data-id="{{ client._id }}" onclick="openEditForm(this)">Edit</button>
                            <button class="delete-button" onclick="openDeleteModal('{{ client._id }}')">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Second table for health details -->
        <h1>Health Details</h1>
        <div class="table-container">
            <table class="health_table" id="healthTable">
                <thead>
                    <tr>
                        <th>High BP</th>
                        <th>Diabetes</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for health in clients %}
                    <tr data-id="{{ health._id }}">
                        <td>{{ health.health_details.highbp }}</td>
                        <td>{{ health.health_details.diabetes }}</td>
                        <td>
                            <button class="edit-button" data-id="{{ health._id }}" onclick="openEditHealthForm(this)">Edit</button>
                            <button class="delete-button" onclick="openDeleteModal('{{ health._id }}')">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <button class="back-to-form-button" onclick="location.href='/';">Back to Form</button>
    </div>

<!-- Edit Health Details Modal -->
<div id="editHealthModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditHealthForm()">&times;</span>
        <h2>Edit Health Details</h2>
        <form id="editHealthForm">
            <input type="hidden" id="editHealthClientId">
            <label for="editHighBp">High BP:</label>
            <input type="text" id="editHighBp" name="highbp" required><br>
            <label for="editDiabetes">Diabetes:</label>
            <input type="text" id="editDiabetes" name="diabetes" required><br>
            <button type="button" onclick="submitEditHealthForm()">Save Changes</button>
        </form>
    </div>
</div>


    <!-- Edit Form Modal -->
<div id="editFormModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditForm()">&times;</span>
        <h2>Edit Client Details</h2>
        <form id="editForm">
            <input type="hidden" id="editClientId">
            <label for="editName">Name:</label>
            <input type="text" id="editName" name="name" required><br>
            <label for="editAddress">Address:</label>
            <input type="text" id="editAddress" name="address" required><br>
            <label for="editZip">Zip Code:</label>
            <input type="text" id="editZip" name="zip" required><br>
            <label for="editPhone">Phone:</label>
            <input type="text" id="editPhone" name="phone" required><br>
            <label for="editBirthdate">Birthdate:</label>
            <input type="date" id="editBirthdate" name="birthdate"><br>
            <label for="editAge">Age:</label>
            <input type="number" id="editAge" name="age" required><br>
            <label for="editSex">Sex:</label>
            <select id="editSex" name="sex" required>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select><br>

           
            <button type="button" onclick="submitEditForm()">Save Changes</button>
        </form>
    </div>
</div>


<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeDeleteModal()">&times;</span>
        <h2>Confirm Delete</h2>
        <p>Are you sure you want to delete this entry?</p>
        <button id="confirmDeleteButton" onclick="deleteClient()">Delete</button>
        <button onclick="closeDeleteModal()">Cancel</button>
    </div>
</div>



    <script>
        function searchTable() {
            var input, filter, clientTable, healthTable, clientRows, healthRows, i, j, clientTd, healthTd, txtValue, shouldDisplayRow;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            clientTable = document.getElementById("clientTable");
            healthTable = document.getElementById("healthTable");
            clientRows = clientTable.getElementsByTagName("tr");
            healthRows = healthTable.getElementsByTagName("tr");
        
            // Loop through all client detail table rows
            for (i = 1; i < clientRows.length; i++) {
                clientRows[i].style.display = "none"; // Initially hide the row
                shouldDisplayRow = false;
                
                clientTd = clientRows[i].getElementsByTagName("td");
                // Loop through all table cells in the client details row
                for (j = 0; j < clientTd.length; j++) {
                    if (clientTd[j]) {
                        txtValue = clientTd[j].textContent || clientTd[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            shouldDisplayRow = true;
                            break;
                        }
                    }
                }
        
                // Corresponding health details row (assuming same number of rows and alignment)
                if (shouldDisplayRow) {
                    healthRows[i].style.display = "";
                } else {
                    healthTd = healthRows[i].getElementsByTagName("td");
                    // Loop through all table cells in the health details row
                    for (j = 0; j < healthTd.length; j++) {
                        if (healthTd[j]) {
                            txtValue = healthTd[j].textContent || healthTd[j].innerText;
                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                shouldDisplayRow = true;
                                break;
                            }
                        }
                    }
                }
        
                // Display the row if any cell matches the filter
                if (shouldDisplayRow) {
                    clientRows[i].style.display = "";
                    healthRows[i].style.display = "";
                } else {
                    clientRows[i].style.display = "none";
                    healthRows[i].style.display = "none";
                }
            }
        }


        // Function to open the delete confirmation modal
        function openDeleteModal(id) {
            var modal = document.getElementById("deleteModal");
            modal.style.display = "block";
            document.getElementById("confirmDeleteButton").setAttribute("data-id", id);
        }

        // Function to close the delete confirmation modal
        function closeDeleteModal() {
            var modal = document.getElementById("deleteModal");
            modal.style.display = "none";
        }
        
        
        function openEditForm(button) {
            var clientId = button.getAttribute("data-id");

            var row = button.closest("tr");
            document.getElementById("editClientId").value = clientId;
            document.getElementById("editName").value = row.cells[0].textContent;
            document.getElementById("editAddress").value = row.cells[1].textContent;
            document.getElementById("editZip").value = row.cells[2].textContent;
            document.getElementById("editPhone").value = row.cells[3].textContent;
            document.getElementById("editBirthdate").value = row.cells[4].textContent;
            document.getElementById("editAge").value = row.cells[5].textContent;
            document.getElementById("editSex").value = row.cells[6].textContent;

           

            document.getElementById("editFormModal").style.display = "block";
        }


        function openEditHealthForm(button) {
            var clientId = button.getAttribute("data-id");

            var row = button.closest("tr");
            document.getElementById("editHealthClientId").value = clientId;

            var healthRow = document.querySelector(`#healthTable tr[data-id="${clientId}"]`);
            document.getElementById("editHighBp").value = healthRow.cells[0].textContent;
            document.getElementById("editDiabetes").value = healthRow.cells[1].textContent;

            document.getElementById("editHealthModal").style.display = "block";
        }

        function closeEditForm() {
            document.getElementById("editFormModal").style.display = "none";
        }

        function closeEditHealthForm() {
            document.getElementById("editHealthModal").style.display = "none";
        }

        function submitEditForm() {
            var clientId = document.getElementById("editClientId").value;
            var formData = {
                name: document.getElementById("editName").value,
                address: document.getElementById("editAddress").value,
                zip: document.getElementById("editZip").value,
                phone: document.getElementById("editPhone").value,
                birthdate: document.getElementById("editBirthdate").value,
                age: document.getElementById("editAge").value,
                sex: document.getElementById("editSex").value,
              
            };

            // Handle empty birthdate
            if (!formData.birthdate) {
                delete formData.birthdate;
            }

            fetch(`/edit_client/${clientId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    var row = document.querySelector(`tr[data-id="${clientId}"]`);
                    row.cells[0].textContent = formData.name;
                    row.cells[1].textContent = formData.address;
                    row.cells[2].textContent = formData.zip;
                    row.cells[3].textContent = formData.phone;
                    row.cells[4].textContent = formData.birthdate || row.cells[4].textContent;
                    row.cells[5].textContent = formData.age;
                    row.cells[6].textContent = formData.sex;

                    

                    closeEditForm();
                    console.log('Client updated successfully');
                } else {
                    console.error('Error updating client');
                }
            })
            .catch(error => console.error('Error:', error));
        }


        function submitEditHealthForm() {
            var clientId = document.getElementById("editHealthClientId").value;
            var formData = {
                highbp: document.getElementById("editHighBp").value,
                diabetes: document.getElementById("editDiabetes").value,
            };

            // Handle empty birthdate
            if (!formData.birthdate) {
                delete formData.birthdate;
            }

            fetch(`/edit_health_client/${clientId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    var row = document.querySelector(`tr[data-id="${clientId}"]`);

                    var healthRow = document.querySelector(`#healthTable tr[data-id="${clientId}"]`);
                    healthRow.cells[0].textContent = formData.highbp;
                    healthRow.cells[1].textContent = formData.diabetes;

                    closeEditHealthForm();
                    console.log('Client updated successfully');
                } else {
                    console.error('Error updating client');
                }
            })
            .catch(error => console.error('Error:', error));
        }
        

        function deleteClient(button) {
            var id = document.getElementById("confirmDeleteButton").getAttribute("data-id");
            fetch(`/delete_client/${id}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (response.ok) {
                    document.querySelector(`tr[data-id='${id}']`).remove();
                    closeDeleteModal();
                } else {
                    alert("Failed to delete the client.");
                }
            })
            .catch(error => console.error('Error:', error));
        }

        // Closing modals when clicking outside of them
        window.onclick = function(event) {
            var modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            });
        }
    </script>
</body>
</html>
